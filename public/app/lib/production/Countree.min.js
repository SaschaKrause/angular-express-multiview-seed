/*! Countree 2013-04-25 */
(function(t){function e(t){function e(){c.userOptionsProvided||console.error(N.ERR_01_OPTIONS_NOT_SET)}function i(){clearInterval(c.countingIntervalReference),c.countingIntervalReference=null}function o(t,e){function n(){var e=new Date;c.alreadyPassedMilliseconds=e.getTime()-t.getTime()+o,c.nowAsDate=e,d.update(),c.onIntervalCallbackFromUser(d),c.isFinished&&(i(),d.countNotifier.fireNotificationEvent(d.countNotifier.EVENT.ON_FINISH))}var o=e?c.alreadyPassedMilliseconds:0;c.countingIntervalReference=setInterval(n,u.updateIntervalInMilliseconds)}var r=this;this.version="0.0.1";var c={nowAsDate:null,userOptionsProvided:!1,startCounterFromMilliseconds:null,stopCounterAtMilliseconds:null,alreadyPassedMilliseconds:-1,isFinished:!1,countingIntervalReference:null,onIntervalCallbackFromUser:null,countDirection:"up",countToDate:null},u={updateIntervalInMilliseconds:1e3,name:"untitled",stopWhenFinished:!1},l=new s(u,c);this.state=f.NOT_STARTED,this.setOptions=function(t){a(u,t)},this.setIntervalCallback=function(t){u.onInterval=t},t&&this.setOptions(t);var d=new n(this,c);this.init=function(){l.updateInternalCountPropertiesFromOptions(r),e(),d.init(),c.onIntervalCallbackFromUser(d),c.alreadyPassedMilliseconds=0,d.countNotifier.fireNotificationEvent(d.countNotifier.EVENT.ON_INIT)},this.start=function(){i(),d.countNotifier.fireNotificationEvent(d.countNotifier.EVENT.ON_START),this.init(),c.isFinished=!1,o(new Date,!1)},this.suspend=function(){i(),d.countNotifier.fireNotificationEvent(d.countNotifier.EVENT.ON_SUSPEND)},this.resume=function(){c.countingIntervalReference||(d.countNotifier.fireNotificationEvent(d.countNotifier.EVENT.ON_RESUME),o(new Date,!0))},this.notifyAt=function(t,e){d.countNotifier.addNotifier(t,e)}}function n(t,e){function n(t){var n=0,i=e.stopWhenFinished&&null!=e.stopCounterAtMilliseconds;if("up"===t&&null!=e.startCounterFromMilliseconds)n=e.startCounterFromMilliseconds+e.alreadyPassedMilliseconds,i&&n>=e.stopCounterAtMilliseconds&&(e.isFinished=!0,n=e.stopCounterAtMilliseconds);else if("down"===t&&null!=e.startCounterFromMilliseconds)n=e.startCounterFromMilliseconds-e.alreadyPassedMilliseconds,i&&e.stopCounterAtMilliseconds>=n&&(e.isFinished=!0,n=e.stopCounterAtMilliseconds);else if(e.countToDate){var o=e.nowAsDate.getTime(),s=e.countToDate.getTime();n=o>s?o-s:s-o}return n}var s=new o;this.calculatedMilliseconds=0,this.countNotifier=new i(t,e),this.init=function(){this.calculatedMilliseconds=e.startCounterFromMilliseconds,s.update(this.calculatedMilliseconds)},this.update=function(){this.calculatedMilliseconds=n(e.countDirection),s.update(this.calculatedMilliseconds)},this.formattedTime=function(){return s}}function i(t,e){var n=[];this.millisecondsStartingPoint=e,this.countreeReference=t,this.EVENT={ON_INIT:"onInit",ON_START:"onStart",ON_FINISH:"onFinish",ON_RESUME:"onResume",ON_SUSPEND:"onSuspend",ON_RESET:"onReset"},this.addNotifier=function(t,e){t.event&&n.push({event:t.event,callback:e})},this.resetNotifier=function(){for(var t=0;n.length>t;++t)n[t].alreadyFired=!1},this.fireNotificationEvent=function(e,i){for(var o=0;n.length>o;++o)n[o].event===e&&n[o].callback(t,i)}}function o(){function t(t){c=t}function e(t){return u.getDigitFromMsForTimeUnit(c,d.DAYS,t)}function n(t){return u.getDigitFromMsForTimeUnit(c,d.HOURS,t)}function i(t){return u.getDigitFromMsForTimeUnit(c,d.MINUTES,t)}function o(t){return u.getDigitFromMsForTimeUnit(c,d.SECONDS,t)}function s(t){return u.getDigitFromMsForTimeUnit(c,d.MILLISECONDS,t)}function a(){return e()+", "+n(2)+":"+i(2)+":"+o(2)+":"+s(3)}var c=0,u=new r;this.update=t,this.getDays=e,this.getHours=n,this.getMinutes=i,this.getSeconds=o,this.getMilliSeconds=s,this.toString=a}function s(t,e){function n(){!t.onInterval&&console.error(N.ERR_04_OPTIONS_CALLBACK_NOT_PROVIDED)}function i(){var e=!!t.customTime&&!t.dateTime,n=!!t.dateTime&&!t.customTime;e?o(t.customTime):n?s(t.dateTime.date):console.error(N.ERR_02_OPTIONS_COUNT_TYPE_WRONG)}function o(t){e.startCounterFromMilliseconds=l(t.startFrom||{}),t.stopAt&&!c(t.stopAt)&&(e.stopCounterAtMilliseconds=l(t.stopAt),r())}function s(t){console.log(t),e.countToDate=t}function r(){e.startCounterFromMilliseconds>e.stopCounterAtMilliseconds&&(e.countDirection="down")}this.updateInternalCountPropertiesFromOptions=function(o){o.name=t.name,n(),e.userOptionsProvided=!0,e.stopWhenFinished=!!t.stopWhenFinished,e.onIntervalCallbackFromUser=t.onInterval||function(){},i()}}function r(){function t(t,e,n){var i=0;return d.MILLISECONDS===e?i=t%1e3:d.SECONDS===e?i=Math.floor(t/1e3)%60:d.MINUTES===e?i=Math.floor(t/1e3/60)%60:d.HOURS===e?i=Math.floor(t/1e3/60/60)%24:d.DAYS===e&&(i=Math.floor(t/1e3/60/60/24)),void 0===n?i:u(i,n)}this.getDigitFromMsForTimeUnit=t}function a(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function c(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0}function u(t,e){for(var n=""+t;e>n.length;)n="0"+n;return n}function l(t){return t.milliseconds||0+1e3*(t.seconds||0)+6e4*(t.minutes||0)+36e5*(t.hours||0)+864e5*(t.days||0)}var d={MILLISECONDS:"ms",SECONDS:"s",MINUTES:"m",HOURS:"h",DAYS:"d"},f={COUNTING:"counting",SUSPENDED:"suspended",NOT_STARTED:"not started"},N={ERR_01_OPTIONS_NOT_SET:"COUNTREE-ERR-01: Please provide some counter options. You can add them directly add instantiation (e.g. new Countree({})) or after that via countree.setOptions({}). Just make sure that there are options provided before starting the Countree.",ERR_02_OPTIONS_COUNT_TYPE_WRONG:"COUNTREE-ERR-02: You need to provide one of the following object inside your Countree option configuration: 'customTime:{}' OR 'dateTime:{}'",ERR_03_OPTIONS_CUSTOM_COUNT_DIRECTION_UNKNOWN:"COUNTREE-ERR-03: You need to specify an 'direction' (with 'up' or 'down') or provide an object to the 'stopAt' property",ERR_04_OPTIONS_CALLBACK_NOT_PROVIDED:"COUNTREE-ERR-04: No 'onInterval'-callback defined in countree options. This callback is necessary as it will be invoked on counting updates at each interval"};"function"==typeof define&&define.amd?define([],function(){return e}):t.Countree=e})("object"==typeof exports&&exports||window);